#!/bin/bash

ID=$1
PASS=123

HOSTNAME=$2
SECRET=$3

MAC1=$4
MAC2=$5

output=`/usr/lib/nagios/plugins/hacked_rad_eap_test -H $HOSTNAME -P 1812 -S $SECRET -m WPA-EAP -e TTLS -u $ID -p $PASS -t 35 -M $MAC1 2>/dev/null`
ttls_code=$?
ttls_out="TTLS: RESUME-EXPLOIT $output"
if [ $ttls_code -eq 0 ]
then
  # test byl uspesny, nema smysl to dal testovat
  echo $ttls_out
  exit 2;
else
  output=`/usr/local/bin/hacked_rad_eap_test -H $HOSTNAME -P 1812 -S $SECRET -m WPA-EAP -e PEAP -u $ID -p $PASS -t 35 -M $MAC2 2>/dev/null`
  peap_code=$?
  peap_out="PEAP: RESUME-EXPLOIT $output"
  if [ $peap_code -eq 0 ]
  then
    # test byl uspesny
    echo $peap_out;
    exit 2;
  fi 
fi

if [ $ttls_code -eq 1 ] || [ $peap_code -eq 1 ]
then
  # reject
  echo "$ttls_out; $peap_out; this is OK";
  exit 0
fi

echo "$ttls_out; $peap_out; problem?"
exit 1;
